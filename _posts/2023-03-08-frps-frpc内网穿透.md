---
title: frps-frpc内网穿透
author: Travis <Hongxu Wei>
date: 2023-03-08 22:23:36 +0800
categories: [DailyNotes Space]
tags: [frp 内网穿透]
math: false
---

👇 frp github链接

[GitHub - fatedier/frp: A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet.](https://github.com/fatedier/frp)

👇 frp 官方使用文档

[概览 | frp](https://gofrp.org/docs/overview/)

Tips：一般有公网ip的服务器作服务端、需要内网穿透的主机作客户端

## 1. 下载

github release页面中写在客户端和服务端二进制文件
服务端、客户端都需要进行下载和部署

## 2. 服务端部署

在具有公网 IP 的机器上部署 frps，修改 frps.ini 文件，这里使用了最简化的配置，设置了 frp 服务器用户接收客户端连接的端口：

```ini
[common]
bind_port = 7000
```

## 3.客户端部署

在需要被访问的内网机器上（SSH 服务通常监听在 22 端口）部署 frpc，修改 frpc.ini 文件，假设 frps 所在服务器的公网 IP 为 x.x.x.x：

```ini
[common]
server_addr = x.x.x.x
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

## 4.启动

分别启动服务端和客户端，注意启动顺序！！！（先启动服务端），否则客户端会连接失败

```bash
frps -c frps.ini
frpc -c frpc.ini
```

## 5.连接

通过 SSH 访问内网机器，假设用户名为 test： 

```bash
ssh -oPort=6000 test@x.x.x.x
```

---


**开启自启动**

（1）客户端安装systemd

```bash
# yum
yum install systemd
# apt
apt install systemd
```

（2）使用文本编辑器，如 `vim` 创建并编辑 `frpc.service` 文件。

```bash
vim /etc/systemd/system/frpc.service
```

写入内容

```
[Unit]
# 服务名称，可自定义
Description = frp server
After = network.target syslog.target
Wants = network.target

[Service]
Type = simple
# 启动frps的命令，需修改为您的frps的安装路径
ExecStart = /path/to/frpc -c /path/to/frpc.ini

[Install]
WantedBy = multi-user.target]
```

==注意ExecStart路径为绝对路径==

（3）开机循环启动：可以自己写个脚本 or 在Service中设置l

==脚本chmod +x给权限==

```bash
#!/bin/bash

function start()
{
        echo "starting"
        /home/firefly/frp/frp_0.47.0_linux_arm64/frpc -c /home/firefly/frp/frp_0.47.0_linux_arm64/frpc.ini
}
start
while [ $? -ne 0 ]
do
        echo "start failed, sleep 1m, start again"
        sleep 1m
        start
done
```

（4）使用systemd命令，管理frpc

```bash
# 启动frp
systemctl start frpc
# 停止frp
systemctl stop frpc
# 重启frp
systemctl restart frpc
# 查看frp状态
systemctl status frpc
```

（5）配置开机自启动

```bash
sudo systemctl daemon-reload

systemctl enable frpc
```
