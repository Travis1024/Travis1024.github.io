---
title: Nacos报错
author: Travis <Hongxu Wei>
date: 2023-03-12 21:59:52 +0800
categories: [Java Learning Space]
tags: [nacos]
math: false
---

报错信息：\[NACOS HTTP-GET] The maximum number of tolerable server reconnection errors has been reached

```java
java.net.ConnectException: [NACOS HTTP-GET] The maximum number of tolerable server reconnection errors has been reached
	at com.alibaba.nacos.client.config.http.ServerHttpAgent.httpGet(ServerHttpAgent.java:107)
	at com.alibaba.nacos.client.config.http.MetricsHttpAgent.httpGet(MetricsHttpAgent.java:48)
	at com.alibaba.nacos.client.config.impl.ClientWorker.getServerConfig(ClientWorker.java:234)
	at com.alibaba.nacos.client.config.NacosConfigService.getConfigInner(NacosConfigService.java:173)
	at com.alibaba.nacos.client.config.NacosConfigService.getConfig(NacosConfigService.java:122)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceBuilder.loadNacosData(NacosPropertySourceBuilder.java:85)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceBuilder.build(NacosPropertySourceBuilder.java:74)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceLocator.loadNacosPropertySource(NacosPropertySourceLocator.java:204)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceLocator.loadNacosDataIfPresent(NacosPropertySourceLocator.java:191)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceLocator.loadApplicationConfiguration(NacosPropertySourceLocator.java:150)
	at com.alibaba.cloud.nacos.client.NacosPropertySourceLocator.locate(NacosPropertySourceLocator.java:103)
	at org.springframework.cloud.bootstrap.config.PropertySourceBootstrapConfiguration.initialize(PropertySourceBootstrapConfiguration.java:98)
	at org.springframework.boot.SpringApplication.applyInitializers(SpringApplication.java:626)
	at org.springframework.boot.SpringApplication.prepareContext(SpringApplication.java:370)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:314)
```

**-----破案-----**

出现此错误的原因是我在项目的pom文件依赖了nacos-config，但是有没有创建一个boostrap的文件

**解决办法有两种：**

1. 将依赖注释掉

```prop
<!-- nacos config 注册中心组件 -->  
<dependency>  
    <groupId>com.alibaba.cloud</groupId>  
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>  
</dependency>
```

2. 创建一个bootstrap.yml文件

bootstrap.yml也是用来加载配置文件的  
applicaiton.yml是用户级的资源配置项  
bootstrap.yml是系统级的，优先级更加高

Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的Application Context的父上下文。初始化的时候，Bootstrap Context负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的Environment。

Bootstrap属性有高优先级，默认情况下，它们不会被本地配置覆盖。 Bootstrap context和Application Context有着不同的约定，所以新增了一个bootstrap.yml文件，保证Bootstrap Context和Application Context配置的分离。

---

当创建完成之后，仍然连接异常，nacos地址已经更改为服务器地址了，但是报错信息仍然显示的是localhost

![image-20230313164232666](https://gitee.com/awtaling/images_repository/raw/master/202303131642744.png)



**-----再次破案-----**

这是nacos读取本身自动配置的优先级高于application文件中的配置时引起的，而nacos本身的自动配置是127.0.0.1:8848端口的nacos服务，所以发生了以上异常，故而需要将配置文件的优先级提升

创建一个bootstrap.properties或bootstrap.yml文件配置nacos地址就可以了。这个配置是系统级的，优先级最高，先从这个文件读取nacos地址就不会报错了

```
spring:
  cloud:
    nacos:
      server-addr: xx.xxx.x.xxx:8848
```

