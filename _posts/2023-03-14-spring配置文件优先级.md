---
title: spring配置文件优先级
author: Travis <Hongxu Wei>
date: 2023-03-14 14:25:00 +0800
categories: [Java Learning Space]
tags: [SpringProfile]
math: false
---

## 1、spring可写的配置文件

- bootstrap.properties
- bootstrap.yml
- application.properties
- application.yml
- ot：bootstrap-dev.yml
- ot：application-dev.yml

**springboot有两种配置文件**
（1）bootstrap.properties
系统级别的参数配置，参数一般是不会动的
（2）application.properties
定义应用级别的配置

## 2、非活动的配置文件

默认情况下是不存在活动的配置文件，即不指定

```prop
spring.profiles.active=?  |  spring.profiles.include=?
```

此时配置文件**加载顺序优先级（由高到低）：**

bootstrap.properties -> bootstrap.yml -> application.properties -> application.yml

==------注意------==

（1）当同一个配置属性在bootstrap.properties和bootstrap.yml文件中都存在时，那么properties中的配置会被加载，而忽略yml文件中的配置（即优先级高的配置覆盖优先级低的配置），不同配置相互互补，此处application(.properties/yml)同理。

（2）但当同一配置在bootstrap.properties和application.properties中都存在时，那么虽然优先加载bootstrap.properties但是会被applicatioin.properties中的配置覆盖，此时则变成了低优先级覆盖高优先的配置

（3）不同的配置会进行互补操作，即SpringBoot会读取全部的配置文件，加载所有不同的配置项，汇成一个总的配置。

## 3、活动的配置文件

指定：（例如：bootstrap-dev.yml, application-dev.yml）

```prop
spring.profiles.active=?  |  spring.profiles.include=?
```

此时配置文件**加载顺序优先级（由高到低）：**

bootstrap-dev.yml ->bootstrap.properties ->application-dev.yml ->application.properties

==------注意：覆盖情况和非活动的配置文件相同------==

如果为同一种配置文件（同为bootstrap），加载优先级高的配置文件覆盖优先级低的配置文件，不同配置互补。

如果为同一类型配置文件（同为.properties），加载优先级低的配置文件覆盖优先级高的配置文件，不同配置互补。

## 4、使用外部配置

例如采用nacos做配置中心，则存在相同配置时以nacos中配置为主（在没有开启本地覆盖nacos远程配置的情况下），nacos中的配置将会覆盖一切本地相同的配置，不同配置可以和本地进行互补。

### （1）nacos开启本地覆盖远程配置

即本地配置优先，如果需要启动参数或者本地配置覆盖远程配置，那么需要在远程配置里配置上允许重写：
```prop
spring.cloud.config.allowOverride=true
```
但这是不够的，尽管它开启了总开关，但是还有两个默认的小开关卡住了，应同时添加如下配置：  
```prop
spring.cloud.config.overrideNone=true  
spring.cloud.config.overrideSystemProperties=false
```

第一个开关是远端不覆盖本地？true 是的，不覆盖。
第二个开关是远端是否覆盖系统配置？false 不覆盖。 （默认为true 覆盖）

请注意,第一个小开关包括第二个。
overrideNone = true的话会开启所有包括本地配置和系统配置并忽略overrideSystemProperties配置。

如果只想开启overrideSystemProperties，那么就是
overrideNone = false，overrideSystemProperties=false。

**所以总的配置信息可以写成**
```yaml
spring:
  cloud:
    config:
      override-none: true
      allow-override: true
      override-system-properties: false  
```

