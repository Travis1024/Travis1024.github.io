---
title: Nim博弈(sg函数+mex)
author: Travis <Hongxu Wei>
date: 2023-03-22 11:06:48 +0800
categories: [DailyNotes Space]
tags: [nim, 博弈论]
math: false
---



## 引言（maybe无用）

最开始知道这个，是因为岳云鹏在一个综艺中玩的游戏

> 游戏内容：
>
> 二人游戏，从1开始，每个人每轮只能顺序报1个 or 2个数字，谁先报出30这个数字，谁赢
>
> 例如：A：1、2	｜ 	B：3	｜ 	A：4、5	｜	B：6、7	｜	A：8	........

思考：无论先后手，如何让自己处于绝对优势嘞（对手要是知道咋玩或者瞎猫碰上死耗子就不是必赢了）



## Nim游戏

这是一个古老而又经典的博弈问题：Nim游戏。Nim游戏是经典的公平组合游戏(ICG)，对于ICG游戏我们有如下定义：

- 两名选手
- 两名选手轮流行动，每一次行动可以在有限合法操作集合中选择一个
- 游戏的任何一种可能的局面(position)，合法操作集合只取决于这个局面本身，不取决于轮到哪名选手操作、以前的任何操作、骰子的点数或者其它因素；局面的改变称为“移动”(move)
- 如果轮到某名选手移动，且这个局面的合法的移动集合为空（也就是说此时无法进行移动），则这名选手负



**对于第三点、进一步定义position：**

- P-position：在当前的局面下，先手必败
- N-position：在当前的局面下，先手必胜



## SG函数

> 问题进入：
>
> 给定一个有向无环图和一个起始顶点上的一枚棋子，Alice和Bob交替的将这枚棋子沿有向边进行移动，无法移动者判负。问是否有必胜策略。



事实上，这个游戏可以认为是所有ICG游戏的抽象模型。也就是说，任何一个ICG游戏都可以通过把每个局面看成一个顶点，对每个局面和它的子局面连一条有向边来抽象成这个“有向图游戏”。下面我们就在有向无环图的顶点上定义SG(Sprague-Garundy)函数。

### sg函数建立+mex运算

首先定义mex (minimal excludant)运算，这是施加于一个集合的运算，表示最小的不属于这个集合的非负整数。例如mex{0,1,2,4}=3、mex{2,3,5}=0、mex{}=0。

对于一个给定的有向无环图，定义关于图的每个顶点的SG函数sg如下：sg(x)=mex{ sg(y) | y是x的后继 }。也就是说，一个点的SG函数为在它所有后继中都未出现的最小的值。

### sg函数的性质

来看一下SG函数的性质。首先，所有的没有出边的顶点，其SG值为0，因为它的后继集合是空集。然后对于一个sg(x)=0的顶点x，它的所有后继y都满足 sg(y)≠ 0。对于一个sg(x)≠ 0的顶点，必定存在一个后继y满足sg(y)=0。

由此可见、SG函数的性质和N,P局面的性质非常相似！

### 表明

**先手必败：P-position当且仅当sg(x)=0（跟P-positioin/N-position的定义是完全对应的）。**

##### 后手必胜：当且仅当sg的异或和为0



## 解决模型

简单变化引言中的游戏

> 游戏内容：
>
> 二人游戏，有一堆石子，共30个，每个人一次只能取一个石子或者两个石子，谁先取完石子谁赢



假设有x个石子，计算不同x的sg值，sg(0)=0

| x    | 取石子数量 | 剩余石子数量 | mex表达式         | sg(x)=mex{} |
| ---- | ---------- | ------------ | ----------------- | ----------- |
| x=1  | 1          | 0            | mex{sg(0)}        | sg(1)=1     |
| x=2  | 1 or 2     | 0 or 1       | mex{sg(0), sg(1)} | sg(2)=2     |
| x=3  | 1 or 2     | 1 or 2       | mex{sg(1), sg(2)} | sg(3)=0     |
| x=4  | 1 or 2     | 2 or 3       | mex{sg(2), sg(3)} | sg(4)=1     |
| x=5  | 1 or 2     | 3 or 4       | mex{sg(3), sg(4)} | sg(5)=2     |
| x=6  | 1 or 2     | 4 or 5       | mex{sg(4), sg(5)} | sg(6)=0     |

寻找sg的变化规律，都是x为3的倍数时，sg=0，为P-position，在当前局面下为先手必败局面。所以从游戏开始，无论先后手如果想胜利，尽可能将对手逼入sg=0（即3的倍数）局面并保持。

如何保持：假设对手取了第3、4块石头，自己取5；假设对手取了第3块石头，自己取第4、5块。



## 阿里云三面题

> 题目内容：
>
> 有60个硬币，一次只能取2、4、6个，最后谁取完谁赢，请你保证先手必胜



和解决模型同理：

假设有x个硬币，计算不同x的sg值，sg(0)=0, sg(1)=0

| x        | 取硬币数量      | 剩余硬币数量    | mex表达式                    | sg(x)=mex{}  |
| -------- | --------------- | --------------- | ---------------------------- | ------------ |
| **x=2**  | **2**           | **0**           | **mex{sg(0)}**               | **sg(2)=1**  |
| x=3      | 2               | 1               | mex{sg(1)}                   | sg(3)=1      |
| **x=4**  | **2 or 4**      | **0 or 2**      | **mex{sg(0), sg(2)}**        | **sg(4)=2**  |
| x=5      | 2 or 4          | 3 or 4          | mex{sg(3), sg(4)}            | sg(5)=2      |
| **x=6**  | **2 or 4 or 6** | **0 or 2 or 4** | **mex{sg(0), sg(2), sg(4)}** | **sg(6)=3**  |
| x=7      | 2 or 4 or 6     | 1 or 3 or 5     | mex{sg(1), sg(3), sg(5)}     | sg(7)=3      |
| **x=8**  | **2 or 4 or 6** | **2 or 4 or 6** | **mex{sg(2), sg(4), sg(6)}** | **sg(8)=0**  |
| x=9      | 2 or 4 or 6     | 3 or 5 or 7     | mex{sg(3), sg(5), sg(7)}     | sg(9)=0      |
| **x=10** | **2 or 4 or 6** | **4 or 6 or 8** | **mex{sg(4), sg(6), sg(8)}** | **sg(10)=1** |



寻找sg的变化规律，当x为8的倍数时，sg值为0，为P-position，在当前局面下为先手必败局面。所以从游戏开始，无论先后手如果想胜利，尽可能将对手逼入sg=0（即8的倍数）局面并保持。

先手第一次可以直接取6枚硬币，就可以保证自己的不败局面。
