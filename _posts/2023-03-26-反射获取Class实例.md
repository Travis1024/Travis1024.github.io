---
title: 反射获取Class实例
author: Travis <Hongxu Wei>
date: 2023-03-26 17:16:51 +0800
categories: [Java Learning Space]
tags: [反射]
math: false
---



## 一、获取Class实例的四种方式

### 1、调用运行时类的属性：.class

> 前提：若已知具体的类，通过类的class属性获取，该方法最为安全可靠， 程序性能最高
> 示例： `Class clazz1 = String.class;`

### 2、通过运行时类的对象,调用getClass()

> 前提：已知某个类的实例，调用该实例的`getClass()`方法获取`Class`对象
> 示例：`Class clazz = “www.atguigu.com”.getClass();`

### 3、调用Class的静态方法：forName(String classPath)

> 前提：已知一个类的全类名，且该类在类路径下，可通过`Class`类的静态方法`forName()` 获取，可能抛出`ClassNotFoundException`
> 示例： `Class clazz = Class.forName(“java.lang.String”);`

### 4、使用类的加载器：ClassLoader

> 示例：
> `ClassLoader cl = this.getClass().getClassLoader();`
> `Class clazz4 = cl.loadClass(“类的全类名”);`

### 5、代码示例

```java
@Test
public void test1() throws ClassNotFoundException {
            //方式一：调用运行时类的属性：.class
            Class clazz1 = Person.class;
            System.out.println(clazz1);//class com.jiaying.java1.Person
            //方式二：通过运行时类的对象,调用getClass()
            Person p1 = new Person();
            Class clazz2 = p1.getClass();
            System.out.println(clazz2);//class com.jiaying.java1.Person

            //方式三：调用Class的静态方法：forName(String classPath)
            Class clazz3 = Class.forName("com.jiaying.java1.Person");
            Class clazz5 = Class.forName("java.lang.String");
            System.out.println(clazz3);//class com.jiaying.java1.Person
            System.out.println(clazz5);//class java.lang.String

            System.out.println(clazz1 == clazz2);//true
            System.out.println(clazz1 == clazz3);//true

            //方式四：使用类的加载器：ClassLoader  (了解)
            ClassLoader classLoader = ReflectionTest.class.getClassLoader();
            Class clazz4 = classLoader.loadClass("com.jiaying.java1.Person");
            System.out.println(clazz4);//class com.jiaying.java1.Person
            System.out.println(clazz1 == clazz4);//true
}
```



## 二、创建运行时类的对象

### 1、说明

- 有了Class对象，能做什么？

  创建类的对象：调用`Class`对象的`newInstance()`方法

  要求：

  - 类必须有一个无参数的构造器。
  - 类的构造器的访问权限需要足够。

- 没有无参的构造器就不能创建对象了吗？

  不是！只要在操作的时候明确的调用类中的构造器，并将参数传递进去之后，才可以实例化操作。
  步骤如下：

  1. 通过`Class`类的`getDeclaredConstructor(Class … parameterTypes)`取得本类的指定形参类型的构造器
  2. 向构造器的形参中传递一个对象数组进去，里面包含了构造器中所需的各个参数。
  3. 通过`Constructor`实例化对象。

### 2、创建步骤

- 根据全类名获取对应的`Class`对象

  ```java
  String name = “atguigu.java.Person";
  Class clazz = null;
  clazz = Class.forName(name);
  ```

- 调用指定参数结构的构造器，生成`Constructor`的实例

  ```java
  Constructor con = clazz.getConstructor(String.class,Integer.class);
  ```

- 通过Constructor的实例创建对应类的对象，并初始化类属性

  ```java
  Person p2 = (Person) con.newInstance("Peter",20);
  System.out.println(p2);
  ```

### 3、代码示例

```java
 @Test
  public void test1() throws IllegalAccessException, InstantiationException {

      Class<Person> clazz = Person.class;
      /*
      newInstance():调用此方法，创建对应的运行时类的对象。内部调用了运行时类的空参的构造器。

      要想此方法正常的创建运行时类的对象，要求：
      1.运行时类必须提供空参的构造器
      2.空参的构造器的访问权限得够。通常，设置为public。


      在javabean中要求提供一个public的空参构造器。原因：
      1.便于通过反射，创建运行时类的对象
      2.便于子类继承此运行时类时，默认调用super()时，保证父类有此构造器

       */
      Person obj = clazz.newInstance();
      System.out.println(obj);

  }
```



## 附录

[Java-反射机制（超详解）](https://blog.csdn.net/weixin_52533007/article/details/123312217)

[java反射实例化对象](https://blog.csdn.net/qq_45369827/article/details/112394137)