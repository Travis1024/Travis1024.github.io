---
title: 将Dubbo提供者注册到公网IP
author: Travis <Hongxu Wei>
date: 2023-06-29 09:25:39 +0800
categories: [Java Learning Space]
tags: [dubbo]
math: false
---

dubbo在启动时，如果没有配置host，会调用 `InetAddress.getLocalHost().getHostAddress()` 获取本地 IP。该方法将会获取机器 `hostname`，然后再在 `/etc/hosts` 配置文件中查找 `hostname` 对应的配置 IP;  如果没有在hosts配置外网ip，默认会注册到内网地址。



- 方法1：修改 hosts 文件，这种方式，会让这个服务器里所有的dubbo应用，都注册到公网ip上（不推荐）

  ```shell
  # 查看hostname
  hostname
  # 修改hosts文件
  vim /est/hosts
  
  # 添加 公网ip 主机名；如下
  11.22.33.44 myHostName
  ```

  原理：加hosts解析，在dubbo 拿hosts时，会拿到公网ip。
  注意：此时hosts文件里不能有内网ip；或者把公网ip 移到 内网ip前。

- 方法 2：启动 jar 包时加参数（推荐）

  ```shell
  # 启动时加参数 -DDUBBO_IP_TO_REGISTRY= 192.168.1.1  该ip为dubbo所在服务器的公网ip即可。
  java -jar  myDubboRpc-api.jar  -DDUBBO_IP_TO_REGISTRY= 192.168.1.1 
  
  # xjar启动
  nohup ./xjar java -DDUBBO_IP_TO_REGISTRY=11.22.33.44 -XX:+UseG1GC -jar $SERVER_NAME  --spring.profiles.active=$SERVER_ENV  &> nohup.out  &
  ```

  > 官方文档https://dubbo.apache.org/zh/docs/advanced/set-host/
  > 原理： 是在dubbo应用启动的时候，去读环境变量，然后通过变量来覆盖一些配置。
  > dubbo启动时读取的环境变量：

  - DUBBO_IP_TO_REGISTRY — 注册到注册中心的IP地址

  - DUBBO_PORT_TO_REGISTRY — 注册到注册中心的端口

  - DUBBO_IP_TO_BIND — 监听IP地址

  - DUBBO_PORT_TO_BIND — 监听端口